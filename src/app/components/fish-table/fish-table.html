<div class="bento-container">
  <!-- Header con filtros -->
  <div class="bento-header">
    <h2>游꿖 Mis Capturas</h2>

    <div class="filters-row">
      <!-- Filtro Tipo de pez -->
      <div class="filter-chip">
        <i class="pi pi-search"></i>
        <p-autoComplete
          [(ngModel)]="fishTypeSearch"
          [suggestions]="fishTypeSuggestions"
          (completeMethod)="filterFishType($event)"
          (onSelect)="applyFilters()"
          (onClear)="applyFilters()"
          placeholder="Tipo de pez"
          [dropdown]="true"
          [forceSelection]="false"
          styleClass="filter-autocomplete">
        </p-autoComplete>
      </div>

      <!-- Filtro Ubicaci칩n -->
      <div class="filter-chip">
        <i class="pi pi-map-marker"></i>
        <p-autoComplete
          [(ngModel)]="locationSearch"
          [suggestions]="locationSuggestions"
          (completeMethod)="filterLocation($event)"
          (onSelect)="applyFilters()"
          (onClear)="applyFilters()"
          placeholder="Ubicaci칩n"
          [dropdown]="true"
          [forceSelection]="false"
          styleClass="filter-autocomplete">
        </p-autoComplete>
      </div>

      <!-- Filtro Usuario -->
      <div class="filter-chip">
        <i class="pi pi-user"></i>
        <p-autoComplete
          [(ngModel)]="userSearch"
          [suggestions]="userSuggestions"
          (completeMethod)="filterUser($event)"
          (onSelect)="applyFilters()"
          (onClear)="applyFilters()"
          placeholder="Usuario"
          [dropdown]="true"
          [forceSelection]="false"
          styleClass="filter-autocomplete">
        </p-autoComplete>
      </div>

      <button
        class="clear-filters-btn"
        (click)="clearFilters()"
        *ngIf="fishTypeSearch || locationSearch || userSearch">
        <i class="pi pi-filter-slash"></i>
        Limpiar
      </button>
    </div>
  </div>

  <!-- Loading skeleton -->
  <div class="bento-grid" *ngIf="loading">
    <div class="bento-card skeleton" *ngFor="let item of [1,2,3,4,5,6]">
      <p-skeleton width="100%" height="200px" borderRadius="12px"></p-skeleton>
      <div class="card-content">
        <p-skeleton width="60%" height="1.5rem"></p-skeleton>
        <p-skeleton width="40%" height="1rem" styleClass="mt-2"></p-skeleton>
      </div>
    </div>
  </div>

  <!-- Bento Grid -->
  <div class="bento-grid" *ngIf="!loading">
    <div
      class="bento-card"
      *ngFor="let capture of filteredCaptures"
      [class.has-images]="capture.images.length > 0">

      <!-- Imagen principal -->
      <div class="card-image-container">
        <img
          [src]="getMainImage(capture)"
          [alt]="capture.fishType"
          class="card-image"
          loading="lazy" />

        <!-- Badge de im치genes -->
        <div class="image-count-badge" *ngIf="capture.images.length > 1">
          <i class="pi pi-images"></i>
          {{ capture.images.length }}
        </div>

        <!-- Overlay con info r치pida -->
        <div class="card-overlay">
          <span class="overlay-weight">{{ capture.weight }} kg</span>
        </div>
      </div>

      <!-- Contenido de la card -->
      <div class="card-content">
        <div class="card-header">
          <h3 class="card-title">{{ capture.fishType }}</h3>
          <span class="card-date">
            <i class="pi pi-calendar"></i>
            {{ capture.captureData | date:'dd/MM/yyyy' }}
          </span>
        </div>

        <div class="card-details">
          <div class="detail-item" *ngIf="capture.location">
            <i class="pi pi-map-marker"></i>
            <span>{{ capture.location }}</span>
          </div>

          <div class="detail-item">
            <i class="pi pi-user"></i>
            <span>{{ capture.userName }}</span>
          </div>
        </div>

        <!-- Miniaturas de im치genes adicionales -->
        <div class="image-thumbnails" *ngIf="capture.images.length > 1">
          <img
            *ngFor="let img of capture.images.slice(1, 4); let i = index"
            [src]="img.thumbnailUrl"
            [alt]="'Imagen ' + (i + 2)"
            class="thumbnail"
            loading="lazy" />
          <div class="more-images" *ngIf="capture.images.length > 4">
            +{{ capture.images.length - 4 }}
          </div>
        </div>
      </div>
    </div>

    <!-- Empty state -->
    <div class="empty-state" *ngIf="filteredCaptures.length === 0">
      <i class="pi pi-inbox empty-icon"></i>
      <h3>No hay capturas que mostrar</h3>
      <p *ngIf="fishTypeSearch || locationSearch || userSearch">
        Intenta ajustar los filtros
      </p>
      <p *ngIf="!fishTypeSearch && !locationSearch && !userSearch">
        춰Registra tu primera captura!
      </p>
    </div>
  </div>
</div>

<app-create-capture (captureCreated)="onCaptureCreated()"></app-create-capture>