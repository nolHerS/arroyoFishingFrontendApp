<div class="bento-container">
  <!-- Header con filtros -->
  <div class="bento-header">
    <h2>ðŸŽ£ Mis Capturas</h2>

    <div class="filters-row">
      <!-- Filtro Tipo de pez -->
      <div class="filter-chip">
        <i class="pi pi-search"></i>
        <p-autoComplete [(ngModel)]="fishTypeSearch" [suggestions]="fishTypeSuggestions"
          (completeMethod)="filterFishType($event)" (onSelect)="applyFilters()" (onClear)="applyFilters()"
          placeholder="Tipo de pez" [dropdown]="true" [forceSelection]="false" styleClass="filter-autocomplete">
        </p-autoComplete>
      </div>

      <!-- Filtro UbicaciÃ³n -->
      <div class="filter-chip">
        <i class="pi pi-map-marker"></i>
        <p-autoComplete [(ngModel)]="locationSearch" [suggestions]="locationSuggestions"
          (completeMethod)="filterLocation($event)" (onSelect)="applyFilters()" (onClear)="applyFilters()"
          placeholder="UbicaciÃ³n" [dropdown]="true" [forceSelection]="false" styleClass="filter-autocomplete">
        </p-autoComplete>
      </div>

      <!-- Filtro Usuario -->
      <div class="filter-chip">
        <i class="pi pi-user"></i>
        <p-autoComplete [(ngModel)]="userSearch" [suggestions]="userSuggestions" (completeMethod)="filterUser($event)"
          (onSelect)="applyFilters()" (onClear)="applyFilters()" placeholder="Usuario" [dropdown]="true"
          [forceSelection]="false" styleClass="filter-autocomplete">
        </p-autoComplete>
      </div>

      @if (fishTypeSearch || locationSearch || userSearch) {
        <button class="clear-filters-btn" (click)="clearFilters()">
          <i class="pi pi-filter-slash"></i>
          Limpiar
        </button>
      }
    </div>
  </div>

  <!-- Loading skeleton -->
  @if (loading) {
    <div class="bento-grid">
      @for (item of [1,2,3,4,5,6]; track item) {
        <div class="bento-card skeleton">
          <p-skeleton width="100%" height="200px" borderRadius="12px"></p-skeleton>
          <div class="card-content">
            <p-skeleton width="60%" height="1.5rem"></p-skeleton>
            <p-skeleton width="40%" height="1rem" styleClass="mt-2"></p-skeleton>
          </div>
        </div>
      }
    </div>
  }

  <!-- Bento Grid -->
  @if (!loading) {
    <div class="bento-grid">
      @for (capture of filteredCaptures; track capture) {
        <div class="bento-card" [class.has-images]="capture.images.length > 0">
          <!-- Imagen principal -->
          <div class="card-image-container">
            <img [src]="getMainImage(capture)" [alt]="capture.fishType" class="card-image" loading="lazy" (error)="onImageError($event)"/>
            <!-- Badge de imÃ¡genes -->
            @if (capture.images.length > 1) {
              <div class="image-count-badge">
                <i class="pi pi-images"></i>
                {{ capture.images.length }}
              </div>
            }
          </div>
          <!-- Contenido de la card -->
          <div class="card-content">
            <div class="card-header">
              <h3 class="card-title">{{ capture.fishType }}</h3>
              <span class="card-date">
                <i class="pi pi-calendar"></i>
                {{ capture.captureData | date:'dd/MM/yyyy' }}
              </span>
            </div>
            <div class="card-details">
              @if (capture.location) {
                <div class="detail-item">
                  <i class="pi pi-map-marker"></i>
                  <span>{{ capture.location }}</span>
                </div>
              }
              <div class="detail-item">
                <i class="pi pi-user"></i>
                <span>{{ capture.userName }}</span>
              </div>
              <div class="detail-item">
                <span class="card-weight">
                  <i class="pi pi-tag"></i>
                  {{ capture.weight }} kg
                </span>
              </div>
            </div>
            <!-- Miniaturas de imÃ¡genes adicionales -->
            @if (capture.images.length > 1) {
              <div class="image-thumbnails">
                @for (img of capture.images.slice(1, 4); track img; let i = $index) {
                  <img [src]="img.thumbnailUrl"
                    [alt]="'Imagen ' + (i + 2)" class="thumbnail" loading="lazy" />
                }
                @if (capture.images.length > 4) {
                  <div class="more-images">
                    +{{ capture.images.length - 4 }}
                  </div>
                }
              </div>
            }
          </div>
        </div>
      }
      <!-- Empty state -->
      @if (filteredCaptures.length === 0) {
        <div class="empty-state">
          <i class="pi pi-inbox empty-icon"></i>
          <h3>No hay capturas que mostrar</h3>
          @if (fishTypeSearch || locationSearch || userSearch) {
            <p>
              Intenta ajustar los filtros
            </p>
          }
          @if (!fishTypeSearch && !locationSearch && !userSearch) {
            <p>
              Â¡Registra tu primera captura!
            </p>
          }
        </div>
      }
    </div>
  }
</div>

<app-create-capture (captureCreated)="onCaptureCreated()"></app-create-capture>